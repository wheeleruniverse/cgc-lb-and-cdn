# Static Data for Lite Deployment

This directory contains static JSON files used by the **lite deployment** on GitHub Pages.

## Files

### `image-pairs.json`
Contains image pairs loaded from Digital Ocean Spaces. This file is **automatically generated** during the GitHub Actions build process.

**Generated By**: `.github/scripts/generate-static-data.js`

**Structure:**
```json
{
  "pairs": [
    {
      "pair_id": "00360dbb-50d6-4804-82f2-4a3c1f0de815",
      "prompt": "A tidal pool reflecting an entire miniature ocean ecosystem.",
      "provider": "freepik",
      "left_url": "https://cgc-lb-and-cdn-content.nyc3.digitaloceanspaces.com/images/freepik/.../left.png",
      "right_url": "https://cgc-lb-and-cdn-content.nyc3.digitaloceanspaces.com/images/freepik/.../right.png"
    }
  ],
  "description": "Image pairs generated from Digital Ocean Spaces",
  "generatedAt": "2025-10-24T...",
  "totalPairs": 42
}
```

### `winners.json`
Placeholder for winners data. In lite mode, winners are tracked locally in localStorage only.

## How It Works

### Automatic Generation (Build Time)

When `cheap-deploy.yml` runs:

1. **List Objects**: Script queries DO Spaces bucket via HTTPS
2. **Group Pairs**: Matches `images/{provider}/{pair-id}/{left|right}.png` pattern
3. **Fetch Metadata**: Reads metadata from response headers:
   - `X-Amz-Meta-Pair-Id`
   - `X-Amz-Meta-Provider`
   - `X-Amz-Meta-Prompt`
   - `X-Amz-Meta-Side`
4. **Generate JSON**: Creates `image-pairs.json` with all discovered pairs
5. **Build Frontend**: Next.js build includes the fresh data

### Data Source

Images come from **Digital Ocean Spaces CDN**:
- Bucket: `cgc-lb-and-cdn-content`
- Path pattern: `images/{provider}/{pair-id}/{side}.png`
- Metadata: Stored in S3 object metadata headers
- Public access: CDN-enabled, no authentication required

### Adding New Images

To add new image pairs:

1. **Full Deployment**: Use the full DO deployment to generate images
2. **Automatic Upload**: Backend uploads to DO Spaces with metadata
3. **Rebuild Lite**: Run `cheap-deploy.yml` to refresh static data
4. **No Manual Update**: Script automatically finds new images!

## Feature Flag Behavior

When `NEXT_PUBLIC_DEPLOYMENT_MODE=lite`:
- Image pairs loaded from `image-pairs.json`
- Votes stored in localStorage only
- No backend API calls
- Local-session tracking only
- Winners tracked per-browser only

When `NEXT_PUBLIC_DEPLOYMENT_MODE=full`:
- Image pairs fetched from backend API
- Votes submitted to backend
- Cross-session tracking via backend/Valkey
- Live statistics from backend
- Winners shared across all users

## ðŸ“š Related Documentation

- **[../../../hosting/docs/dual-deployment.md](../../../hosting/docs/dual-deployment.md)** - Complete setup guide
- **[../../../hosting/docs/spaces-integration.md](../../../hosting/docs/spaces-integration.md)** - How this data is generated
- **[../../../hosting/docs/deployment-workflows.md](../../../hosting/docs/deployment-workflows.md)** - Workflow documentation
